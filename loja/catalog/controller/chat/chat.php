<?phpclass ControllerChatChat extends Controller {    public function index() {        $this->load->model('chat/chat');        $online = $this->model_chat_chat->chat_online();        if (!$online) {            $this->redirect($this->url->link('chat/chat/offline'));            exit;        }        $this->template = 'default/template/chat/chat.tpl';        $this->response->setOutput($this->render());    }    function sair_chat() {        $this->load->model('chat/chat');        $this->model_chat_chat->sair_chat($this->request->get['ch_id']);    }    public function verificar_status() {        $this->load->model('chat/chat');        $online = $this->model_chat_chat->chat_online();        if (!$online) {            die(json_encode(array('online' => 0)));        } else {            die(json_encode(array('online' => 1)));        }    }    public function offline() {        $this->template = 'default/template/chat/offline.tpl';        $this->response->setOutput($this->render());    }    public function iniciar_conversa() {        $this->load->model('chat/chat');        $conversa = $this->model_chat_chat->iniciar_nova_conversa($this->request->post);        if ($conversa) {            $this->redirect($this->url->link('chat/chat/conversa', 'conversa=' . $conversa));        } else {            $this->redirect($this->url->link('chat/chat'));        }    }    public function so_conversa() {        $this->load->model('chat/chat');        $rs_conversa = $this->model_chat_chat->get_conversa($this->request->get['ch_id']);        if ($this->model_chat_chat->chat_online()) {            echo $rs_conversa->row['ch_conversa'];        } else {            echo $rs_conversa->row['ch_conversa'] . "<div style='color:#f00; font-size:13px;'>Atenção: O atendente saiu da conversa!</div>";        }    }    public function nova_conversa() {        $this->load->model('chat/chat');        $rs_conversa = $this->model_chat_chat->get_conversa($this->request->get['ch_id']);        $conversa = $rs_conversa->row['ch_conversa'] . "		<div class=\"atendido\"><strong>" . $this->request->post['ch_nome'] . " <i>" . date('H:i:s') . "</i>: </strong> " . $this->request->post['msg'] . "</div>";        $this->model_chat_chat->nova_conversa($this->request->get['ch_id'], $conversa);        echo $conversa;    }    public function conversa() {        $this->load->model('chat/chat');        $rs_conversa = $this->model_chat_chat->get_conversa($this->request->get['conversa']);        $this->data['conversa'] = $rs_conversa->row;        $this->template = 'default/template/chat/conversa.tpl';        $this->response->setOutput($this->render());    }}