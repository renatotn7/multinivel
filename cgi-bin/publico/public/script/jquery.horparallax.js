/*
 * Horparallax
 *
 * @version 1.0
 *
 * Copyright 2013, UpSolution
 */!function(e){var t=function(t,n){var r=this;this.$window=e(window),this.container=e(t),t.onclick!=undefined&&(n=e.extend({},t.onclick()||{},typeof n=="object"&&n),this.container.removeProp("onclick")),n=e.extend({},e.fn.horparallax.defaults,typeof n=="object"&&n),this.options=n,this.bg=this.container.find(n.bgSelector),this.containerWidth=this.container.outerWidth(),this.containerHeight=this.container.outerHeight(),this.bgWidth=this.bg.outerWidth(),this.windowHeight=this.$window.height(),this._frameRate=Math.round(1e3/this.options.fps),this.mouseInside=!1,(!("ontouchstart"in window)||!("DeviceOrientationEvent"in window))&&this.container.mouseenter(function(e){r.mouseInside=!0;var t=r.container.offset(),n=(e.pageX-t.left)/r.containerWidth;r.cancel(),r._hoverAnimation=!0,r._hoverFrom=r.now,r._hoverTo=n,r.start(r._hoverTo)}).mousemove(function(e){if(!r.mouseInside)return;if(r._lastFrame+r._frameRate>Date.now())return;var t=r.container.offset(),n=(e.pageX-t.left)/r.containerWidth;if(r._hoverAnimation){r._hoverTo=n;return}r.set(n),r._lastFrame=Date.now()}).mouseleave(function(e){r.mouseInside=!1,r.cancel(),r.start(r.options.basePoint)}),this.$window.resize(function(){r.handleResize()}),this._orientationDriven="ontouchstart"in window&&"DeviceOrientationEvent"in window,this._orientationDriven&&(this._checkIfVisible(),window.addEventListener("deviceorientation",function(e){if(!r.visible||r._lastFrame+r._frameRate>Date.now())return;r._deviceOrientationChange(e),r._lastFrame=Date.now()}),this.$window.resize(function(){r._checkIfVisible()}),this.$window.scroll(function(){r._checkIfVisible()})),this.set(this.options.basePoint),this._lastFrame=Date.now()};t.prototype={_deviceOrientationChange:function(e){var t=e.gamma,n=e.beta,r,i;switch(window.orientation){case-90:n=Math.max(-45,Math.min(45,n)),r=(n+45)/90;break;case 90:n=Math.max(-45,Math.min(45,n)),r=(45-n)/90;break;case 180:t=Math.max(-45,Math.min(45,t)),r=(t+45)/90;break;case 0:default:if(t<-90||t>90)t=Math.abs(e.gamma)/e.gamma*(180-Math.abs(e.gamma));t=Math.max(-45,Math.min(45,t)),r=(45-t)/90}this.set(r)},handleResize:function(){this.containerWidth=this.container.outerWidth(),this.containerHeight=this.container.outerHeight(),this.bgWidth=this.bg.outerWidth(),this.windowHeight=this.$window.height(),this.set(this.now)},_checkIfVisible:function(){var e=this.$window.scrollTop(),t=this.container.offset().top;this.visible=t+this.containerHeight>e&&t<e+this.windowHeight},set:function(e){return this.bg.css("left",(this.containerWidth-this.bgWidth)*e),this.now=e,this},compute:function(e,t,n){return this._hoverAnimation?(this._hoverTo-this._hoverFrom)*n+this._hoverFrom:(t-e)*n+e},start:function(e){var t=this.now,n=this;return this.container.css("delta",0).animate({delta:1},{duration:this.options.duration,easing:this.options.easing,complete:function(){n._hoverAnimation=!1},step:function(r){n.set(n.compute(t,e,r))},queue:!1}),this},cancel:function(){return this._hoverAnimation=!1,this.container.stop(!0,!1),this}},e.easing.easeOutElastic==undefined&&(e.easing.easeOutElastic=function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n}),e.fn.horparallax=function(n){return this.each(function(){var r=e(this),i=r.data("horparallax");i||r.data("horparallax",i=new t(this,n))})},e.fn.horparallax.defaults={fps:60,basePoint:.5,duration:500,bgSelector:".l-submain-bg",easing:"swing"},e.fn.horparallax.Constructor=t}(jQuery);