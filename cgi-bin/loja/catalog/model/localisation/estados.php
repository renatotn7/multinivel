<?php/** * Busca de estados, cidades e bairro para filtrar distribuidores * @author Werlon */class ModelLocalisationEstados extends Model {    /**     * Busca diretamente os distribuidores ativos pelo estado     * @param int $es_id     * @return array     */    public function getDistribuidorPorEstado($es_id) {        $query = $this->db->query("SELECT di_id,di_usuario "            . "FROM distribuidores "            . "JOIN registro_ativacao ON at_distribuidor = di_id "            . "WHERE at_data >= '" . date("Y-m-01 00:00:00") . "' "            . "AND di_uf = '" . (int)$es_id . "'");        return $query->rows;    }    /**     * Busca a cidade com distribuidores ativos pelo estado escolhido     * @param int $es_id     * @return array     */    public function getCidadePorEstado($es_id) {        $query = $this->db->query("SELECT di_cidade, ci_nome "            . "FROM distribuidores "            . "JOIN registro_ativacao ON at_distribuidor = di_id "            . "JOIN cidades ON ci_id = di_cidade "            . "WHERE at_data >= '" . date("Y-m-01 00:00:00") . "' "            . "AND di_uf = '" . (int)$es_id . "'"            . "GROUP BY di_cidade ORDER BY ci_nome");        return $query->rows;    }    /**     * Busca bairros com distribuidores ativos pela cidade escolhida     * @param int $ci_id     * @return array     */    public function getBairrosPorCidade($ci_id) {        $query = $this->db->query("SELECT DISTINCT di_bairro "            . "FROM distribuidores "            . "JOIN registro_ativacao ON at_distribuidor = di_id "            . "WHERE at_data >= '" . date("Y-m-01 00:00:00") . "' "            . "AND di_cidade = '" . (int)$ci_id . "'");        return $query->rows;    }    /**     * Busca bairros com distribuidores ativos no estado informado     * @param int $es_id     * @return array     */    public function getBairrosPorEstado($es_id) {        $query = $this->db->query("SELECT DISTINCT di_bairro "            . "FROM distribuidores "            . "JOIN registro_ativacao ON at_distribuidor = di_id "            . "WHERE at_data >= '" . date("Y-m-01 00:00:00") . "' "            . "AND di_uf = '" . (int)$es_id . "'");        return $query->rows;    }    /**     * Busca os distribuidores ativos pelo bairro e estado     * @param string $bairro_nome     * @param int $es_id     * @return array     */    public function getDistribuidorPorBairro($bairro_nome,$es_id='') {                $estado = $es_id!=''?"AND di_uf = '" . (int)$es_id . "' ":"";        $query = $this->db->query("SELECT di_id,di_usuario "            . "FROM distribuidores "            . "JOIN registro_ativacao ON at_distribuidor = di_id "            . "WHERE at_data >= '" . date("Y-m-01 00:00:00") . "' "            . "AND di_bairro LIKE '%$bairro_nome%'"            . $estado            . "GROUP BY di_id "            . "ORDER BY di_usuario");        return $query->rows;    }    public function getEstados() {        $query = $this->db->query("SELECT * FROM estados WHERE es_id <= '27' ORDER BY es_nome ASC");        $estados = $query->rows;        return $estados;    }}?>